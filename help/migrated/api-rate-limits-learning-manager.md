---
jcr-language: en_us
title: Learning ManagerのAPIレート制限
contentowner: saghosh
preview: true
source-git-commit: 544c695a77c21dd9162b9b943b6119d27aa373dc
workflow-type: tm+mt
source-wordcount: '1757'
ht-degree: 51%

---



# Learning ManagerのAPIレート制限

## レート制限の概要 {#introductiontoratelimiting}

AdobeのLearning Managerでは、REST APIの豊富なスイートが提供されます。このスイートを使用して、Learning Managerと連携するアプリケーションを構築できます。また、業務に役立つワークフローを使用して、カスタムユーザーエクスペリエンスや拡張機能を構築することもできます。

APIが呼び出されるたびに、Learning Managerサーバーで利用される共有の計算リソースが存在します。そのため、アプリケーションが適切に動作し、プラットフォームのパフォーマンスと可用性の特性を損なわないように注意する必要があります。 これは、APIクライアントが呼び出しを行う方法（周波数と速度）に制限を設けることによって実現されます。

例えば、アプリケーションがそのアカウント内のすべてのユーザーを取得しようとしていて、複数のページ分割API呼び出しを高速で行う可能性があります。 誤って開発者がこれをタイトループで呼び出すと、サーバーに多大な負荷がかかり、アプリケーションの動作が遅くなり、意図した動作や要求される動作よりも多くのリソースが消費され、プラットフォームが危険にさらされることになります。

この問題を解決するために、特定のアカウントの特定のクライアントアプリケーションで1人のユーザーが実行できるAPI呼び出しの数にレート制限を導入しています。 これは、1分あたりのリクエスト数で測定します。RPMと略します。 例えば、GET API呼び出しの制限を600 RPMと言った場合、それは1人のユーザーが1分間に最大600回の呼び出しを超えることはできません。ユーザーがこの制限を超えると、レートが制限されます。 リクエストはミリ秒の粒度で追跡されるため、この制限は100ミリ秒（ミリ秒）ごとに1つのリクエストに対応します。 Burstというパラメータがもう1つ存在します。これはレート制限と共に定義され、指定されたレート（この例では600RPM）を超えてユーザーが実行できるリクエストの数を定義します。 例えば、Burstパラメータが10の場合、最大10個のスロットがキューに割り当てられ、リクエストが「too soon」（この例では100ミリ秒より早い）に到達すると、キューに利用可能なスロットがある場合は、すぐに処理されます。 その後、スロットは「テイク」としてマークされ、適切な時間（この例では100ms後）が経過するまで、別のリクエストで使用するために解放されません。 実際のトラフィックは一般的にバーストを伴います。バーストパラメータが役立ちます。 Learning Managerプラットフォームでは、APIバージョン（例：V2）、ロール（学習者/管理者）、および動詞(GET/PUT/POST/DELETE/PATCH)に関する制限を定義します。 上記の例で説明すると、レート制限は(600, 10)になります。

Learning ManagerではパブリックAPIのレートに常に制限がありますが、これまでのところ、非常に高いRPMを許可することには非常に柔軟でした。 しかし、お気に入りの学習プラットフォームの増加に伴い、APIの使用が急激に増加しています。そのため、すべての顧客の利益のために、またプラットフォームの管理を改善するために、これらのレート制限を明示的に文書化することにしました。 このコンテキストでは、新しいAPI応答（HTTPステータスコード429）を返し始めるために、APIをアップグレードしました。これまでご覧いただいていないものです。 この応答は、レート制限に違反した場合にAPIクライアントに提供されます。 クライアントアプリケーションは、アプリケーションのロジックに適するようにこのレスポンスコードを処理する必要があります。この文書は、開発者がレスポンスを見たときに、コードに適切なロジックを組み込むために必要な情報を提供することを主な目的としています。

## どの方法でレート制限を確認できますか？ {#howtoconfirmtheenforcedratelimits}

各リクエストのレスポンスヘッダーには、次の情報が含まれています。

```
x-rate-limit: 600r/m 
x-burst: 10
```

* x-rate-limitは、1分あたりのリクエスト数で基本リクエストレートのしきい値を指定します。
* x-burstは、ベースリクエストレートを超える超過リクエストの数が、即座に処理を受け入れられるかどうかを指定します。

## レート制限によって発生したエラーを検出する方法 {#howtocatcherrorscausedbyratelimits}

各リクエストについて、レート上限に達したかどうかを確認できます。 応答コード429「{&quot;message&quot;:&quot;429 Too many requests&quot;}」が表示された場合は、レート制限に達しています。

429個の応答を取得するコードをスクリプトに含めるのが最適な方法です。 スクリプトが「リクエストが多すぎます」エラーを無視してリクエストを続けると、nullエラーが発生する可能性があります。 この時点では、エラー情報は問題の診断には役立ちません。

例えば、レート制限に突き当たるカール要求は、次のような応答を返します。

```
< HTTP/2 429 
< date: Wed, 04 Nov 2020 06:53:04 GMT 
< content-type: application/json; charset=utf-8 
< server: openresty 
< x-rate-limit: 60r/m 
< x-burst: 10 
< retry-after: 10.752 
< access-control-allow-credentials: true 
< access-control-allow-methods: GET, POST, OPTIONS, PUT, HEAD, DELETE, PATCH 
< access-control-allow-headers: X-acap-all-roles, X-acap-account,X-acap-user,X-acap-caller-role,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type, x-experience-api-version, Authorization, X-CSRF-TOKEN, X-HTTP-Method-Override 
< strict-transport-security: max-age=31536000; includeSubDomains 
< x-frame-options: SAMEORIGIN 
< x-xss-protection: 1 
< x-content-type-options: nosniff 
< x-request-id: gwBBFC9741-58A5-43B1-B1FE-7D14275961E7 
< strict-transport-security: max-age=31536000; includeSubDomains
```

応答には、次のキーに関する情報が含まれています。

```
status: 429 
retry-after: 10.752
```

ステータスコード429は、「リクエストが多すぎます」を意味し、現在のリクエストが処理されていないことを示します。 retry-afterヘッダーは、API呼び出しを10.752秒で再試行できることを指定します。 コードは、再試行に十分な時間が経過するまで、追加のAPI要求を停止する必要があります。

次の疑似コードは、レート制限エラーを簡単にキャッチする方法を示しています。

```
response = request.get(url) 
if response.status equals 429: 
    alert('Rate limited. Waiting to retry…') 
    wait(response.retry-after) 
    retry(url)
```

実際に、429のステータスコードを快適に処理できるように、Learning ManagerのダミーAPIも作成しました。

```
curl -X GET --header 'Accept: application/json' --header 'Authorization: oauth < 
<token>
  >' 'https://learningmanager.adobe.com/learningmanagerapi/v2/dummy 
</token>
```

このダミーAPIには、次の制限があります。

```
x-rate-limit: 5r/m 
x-burst: 2
```

ダミーAPIの上限は意図的に低く設定されているため、レート制限に素早く突き当たると、レート制限エラーを検出して処理するためのコードの開発に集中することができます。

## ダミーAPIのテスト {#testingthedummyapi}

レート制限の仕組みを確認するためのエンドポイントを提供しました。 この目的のために、学習者の読み取りスコープを持つGET /dummyという特別なエンドポイントを作成しました。 このAPIは、1分あたり5つのリクエストという非常に厳しいレート制限で意図的に設定されており、バースト制限= 2になっています。

このエンドポイントに5RPM未満と5RPM以上のレートでヒットすると、これを簡単にテストできます。 応答ヘッダーの情報に基づいて、HTTPSステータスコード429を処理するコードを記述します。

これを簡単に説明するサンプルのJavaCriptコードを確認できます。 ここをクリック [バイオリン](https://jsfiddle.net/ACAPJS/9yv8zcmL/) を実行し、コードの動作を確認します。

このアプリケーションでは、アカウントの学習者ロールのアプリケーショントークンを提供する必要があります。 を参照してください [アプリケーションデベロッパーマニュアル](https://captivateLearning Manager.adobe.com/docs/Learning Managerapi/v2/)APIトークンに関する情報を表示し、Learning Manager統合管理アプリケーションの「開発者リソース」セクションでトークンヘルパーを使用して、トークンを生成できます。

このアプリケーションは、1回の操作でダミーAPIに10回の呼び出しを行っています。 ダミーAPIのレート制限は(5, 2)であるため、Learning Managerが受信した最初の5+2呼び出しが成功すると、レート制限に違反し、成功応答が表示されます。

ただし、このアプリケーションが応答で429のステータスコードを検索し、それらを処理する方法に注意してください。 このアプリケーションはそのような応答を受け取ると、API応答の詳細を出力し、提案された時間を待機して、失敗した試行を再試行します。

## レート制限を処理するためのベストプラクティス {#bestpracticestohandleratelimiting}

多くの場合、アカウント内のデータはそれほど頻繁には変更されません。 例えば、アカウント内のコースは、それほど頻繁に変更されることはありません。 毎回すべてのデータを取得しようとするのではなく、必要なときに特定のデータを取得できるかどうかを確認し、キャッシュ機構の使用を検討してください。 こうすれば、アプリケーションが本当に多くのコールを行う必要がある場合に、これらの重要なコールを行うための十分な割り当て量がレート制限内に確保されます。

一部のデータは頻繁に変更される場合があり、頻繁に取得する必要がある場合もあります。 もしそうであったとしても、アプリケーションにわずかに古いデータ（キャッシュに含まれているもの、N分前に取り込んだもの）を持たせることができるかどうか自問してみて下さい。なぜなら、これはユーザのワークフローには関係ないからです。 サーバから新しいデータを取得する必要がある場合でも、必要なデータだけを取得する方が、すべてを取得するよりも賢明です。

また、APIは柔軟ではないので、大量のデータを取得する選択肢がない場合には、1回の呼び出しで望むものを正確に提供できないことがあります。 APIで、呼び出し数を最小限に抑えるために使用できるフィルターや並べ替え条件が提供されるかどうかを確認します。それでも、アカウント内の多くのユーザーが同じデータを必要とする場合があるため、キャッシュを検討する必要があります。

GUIを使用するインタラクティブなアプリケーションのコンテキストでデータが大量に取得されている場合、アプリケーションが過剰な処理を試みており、アプリケーションのユーザーエクスペリエンスに影響を与える多くの情報/機能でユーザーを圧倒している可能性があります。

非インタラクティブなアプリケーション（日常業務など）を構築している場合、大量のデータを一括で取得する必要が生じることがあります。 このような場合は、主にCSV形式でバルクデータを返すように設計されたジョブAPIの使用を検討してください。 ジョブAPIには、1日にN回呼び出すことができるクォータ制約があることに注意してください。

Learning ManagerはJSONAPI仕様を実装しているため、一部のデータをサイドロードできるAPIもあります。 これは追加のAPI呼び出しを節約するのに役立ちますが、データの取得に熱心になりすぎるという点で妥協する必要があります。 サイドロードデータは非常に大きい場合があるため、APIのページネーション呼び出しでは、最大ページサイズを10に制限しています。しかし、インクルードを伴わないAPI呼び出しでは、より大きなページサイズ（最大100）を指定できる場合があります

短時間に大量のAPIリクエストを行うと、リクエストのAPIレート制限に遭遇します。 上限に達すると、一定の時間が経過するまで、Learning Managerはこれ以上のリクエストの処理を停止します。

レート制限の概要は、この記事の最後のセクションで説明します。 制限事項を理解しておくことをお勧めします。

## V2 APIエンドポイントのレート制限 {#ratelimitsforv2apiendpoints}

次の表に、さまざまなV 2エンドポイントの制限を示します。 現時点では、お客様にレート制限は適用されていませんが、これらの制限はDD/MM/YYYYから適用されます。 そのため、お客様が既存のアプリケーションのコードを確認して、これらのレート制限を認識するようにコードを調整する方法と、HTTPステータスコード429でAPI応答を処理する方法を確認することが重要です。

<table> 
 <tbody>
  <tr> 
   <td><p><b>操作</b></p></td> 
   <td><p><b>Admin API</b></p></td> 
   <td><p><b>学習者 API</b></p></td> 
  </tr> 
  <tr> 
   <td><p>DELETE</p></td> 
   <td><p>(25、10) <br></p></td> 
   <td><p>(20、10)<br></p></td> 
  </tr> 
  <tr> 
   <td><p>PATCH</p></td> 
   <td><p>(60, 20)</p></td> 
   <td><p>(15、5) <br></p></td> 
  </tr> 
  <tr> 
   <td><p>POST</p></td> 
   <td><p>(30、10)<br></p></td> 
   <td><p>(30、10)<br></p></td> 
  </tr> 
  <tr> 
   <td><p>PUT</p></td> 
   <td><p>(20、10)<br></p></td> 
   <td><p>(20、10)<br></p></td> 
  </tr> 
  <tr> 
   <td><p>GET</p></td> 
   <td><p>(100、100)<br></p></td> 
   <td><p>(100、30)<br></p></td> 
  </tr> 
 </tbody>
</table>

